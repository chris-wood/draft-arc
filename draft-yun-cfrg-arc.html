<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Anonymous Rate-Limited Credentials</title>
<meta content="Cathie Yun" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document specifies the Anonymous Rate-Limited Credential (ARC) protocol,
a specialization of keyed verification anonymous credentials with support for
rate limiting. ARC credentials can be presented from client to server up to
some fixed number of times, where each presentation is cryptographically bound
to client secrets and application-specific public information, such that each
presentation is unlinkable from the others as well as the original credential
creation. ARC is useful in applications where a server needs to throttle or
rate-limit access from anonymous clients. 
    " name="description">
<meta content="xml2rfc 3.25.0" name="generator">
<meta content="draft-yun-cfrg-arc-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.25.0
    Python 3.12.8
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.5
    lxml 5.3.0
    platformdirs 4.3.6
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-yun-cfrg-arc.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">ARC</td>
<td class="right">January 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Yun &amp; Wood</td>
<td class="center">Expires 3 August 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-yun-cfrg-arc-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-01-30" class="published">30 January 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-08-03">3 August 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C. Yun</div>
<div class="org">Apple, Inc.</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Apple, Inc.</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Anonymous Rate-Limited Credentials</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies the Anonymous Rate-Limited Credential (ARC) protocol,
a specialization of keyed verification anonymous credentials with support for
rate limiting. ARC credentials can be presented from client to server up to
some fixed number of times, where each presentation is cryptographically bound
to client secrets and application-specific public information, such that each
presentation is unlinkable from the others as well as the original credential
creation. ARC is useful in applications where a server needs to throttle or
rate-limit access from anonymous clients.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://chris-wood.github.io/draft-kvac/draft-yun-cfrg-kvac.html">https://chris-wood.github.io/draft-kvac/draft-yun-cfrg-kvac.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-yun-cfrg-arc/">https://datatracker.ietf.org/doc/draft-yun-cfrg-arc/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Crypto Forum  mailing list (<span><a href="mailto:cfrg@ietf.org">mailto:cfrg@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/cfrg">https://mailarchive.ietf.org/arch/browse/cfrg</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/cfrg/">https://www.ietf.org/mailman/listinfo/cfrg/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/chris-wood/draft-kvac">https://github.com/chris-wood/draft-kvac</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 3 August 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-notation-and-terminology" class="internal xref">Notation and Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-preliminaries" class="internal xref">Preliminaries</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-prime-order-group" class="internal xref">Prime-Order Group</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-arc-protocol" class="internal xref">ARC Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-key-generation" class="internal xref">Key Generation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-issuance" class="internal xref">Issuance</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-credential-request" class="internal xref">Credential Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-credential-response" class="internal xref">Credential Response</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.3">
                    <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="auto internal xref">4.2.3</a>.  <a href="#name-finalize-credential" class="internal xref">Finalize Credential</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-presentation" class="internal xref">Presentation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-presentation-state" class="internal xref">Presentation State</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-presentation-construction" class="internal xref">Presentation Construction</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-presentation-verification" class="internal xref">Presentation Verification</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-zero-knowledge-proofs" class="internal xref">Zero-Knowledge Proofs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-schnorr-compiler" class="internal xref">Schnorr Compiler</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-prover" class="internal xref">Prover</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="auto internal xref">5.1.2</a>.  <a href="#name-verifier" class="internal xref">Verifier</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-credentialrequest-proof" class="internal xref">CredentialRequest Proof</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-credentialrequest-proof-cre" class="internal xref">CredentialRequest Proof Creation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-credentialrequest-proof-ver" class="internal xref">CredentialRequest Proof Verification</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-creentialresponse-proof" class="internal xref">CreentialResponse Proof</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="auto internal xref">5.3.1</a>.  <a href="#name-credentialresponse-proof-cr" class="internal xref">CredentialResponse Proof Creation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.2">
                    <p id="section-toc.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="auto internal xref">5.3.2</a>.  <a href="#name-credentialresponse-proof-ve" class="internal xref">CredentialResponse Proof Verification</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-presentation-proof" class="internal xref">Presentation Proof</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.1">
                    <p id="section-toc.1-1.5.2.4.2.1.1"><a href="#section-5.4.1" class="auto internal xref">5.4.1</a>.  <a href="#name-presentation-proof-creation" class="internal xref">Presentation Proof Creation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.2">
                    <p id="section-toc.1-1.5.2.4.2.2.1"><a href="#section-5.4.2" class="auto internal xref">5.4.2</a>.  <a href="#name-presentation-proof-verifica" class="internal xref">Presentation Proof Verification</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-ciphersuites" class="internal xref">Ciphersuites</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-arcp-384-sha-384" class="internal xref">ARC(P-384, SHA-384)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-random-scalar-generation" class="internal xref">Random Scalar Generation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="auto internal xref">6.2.1</a>.  <a href="#name-rejection-sampling" class="internal xref">Rejection Sampling</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="auto internal xref">6.2.2</a>.  <a href="#name-random-number-generation-us" class="internal xref">Random Number Generation Using Extra Random Bits</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-credential-issuance-unlinka" class="internal xref">Credential Issuance Unlinkability</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-presentation-unlinkability" class="internal xref">Presentation Unlinkability</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-timing-leaks" class="internal xref">Timing Leaks</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-test-vectors" class="internal xref">Test Vectors</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-arcv1-p384-sha384" class="internal xref">ARCV1-P384-SHA384</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document specifies the Anonymous Rate-Limited Credential (ARC) protocol,
a specialization of keyed verification anonymous credentials with support for
rate limiting.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">ARC is privately verifiable (keyed-verification), yet differs from similar token-based
protocols in that each credential can be presented multiple times without violating
unlinkability of different presentations. Servers issue credentials to clients that
are cryptographically bound to client secrets and some public information.
Afterwards, clients can present this credential to the server up to some fixed
number of times, where each presentation provides proof that it was derived
from a valid (previously issued) credential and bound to some public information.
Each presentation is pairwise unlinkable, meaning the server cannot link any two
presentations to the same client credential, nor can the server link a presentation
to the preceding credential issuance flow. Notably, the maximum number of
presentations from a credential is fixed by the application.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">ARC is useful in settings where applications require a fixed number of zero-knowledge
proofs about client secrets that can also be cryptographically bound to some public
information. This capability lets servers use credentials in applications that need
throttled or rate-limited access from anonymous clients.<a href="#section-1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<div id="notation-and-terminology">
<section id="section-2.1">
        <h3 id="name-notation-and-terminology">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-notation-and-terminology" class="section-name selfRef">Notation and Terminology</a>
        </h3>
<p id="section-2.1-1">The following functions and notation are used throughout the document.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-2.1">
            <p id="section-2.1-2.1.1">concat(x0, ..., xN): Concatenation of byte strings. For example,
concat(0x01, 0x0203, 0x040506) = 0x010203040506.<a href="#section-2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.2">
            <p id="section-2.1-2.2.1">bytes_to_int and int_to_bytes: Convert a byte string to and from a non-negative integer.
bytes_to_int and int_to_bytes are implemented as OS2IP and I2OSP as described in
<span>[<a href="#RFC8017" class="cite xref">RFC8017</a>]</span>, respectively. Note that these functions operate on byte strings
in big-endian byte order.<a href="#section-2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.3">
            <p id="section-2.1-2.3.1">random_integer_uniform(M, N): Generate a random, uniformly distributed integer R
between M inclusive and N exclusive, i.e., M &lt;= R &lt; N.<a href="#section-2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.4">
            <p id="section-2.1-2.4.1">random_integer_uniform_excluding_set(M, N, S): Generate a random, uniformly
distributed integer R between M inclusive and N exclusive, i.e., M &lt;= R &lt; N,
such that R does not exist in the set of integers S.<a href="#section-2.1-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.1-3">All algorithms and procedures described in this document are laid out
in a Python-like pseudocode. Each function takes a set of inputs and parameters
and produces a set of output values. Parameters become constant values once the
protocol variant and the ciphersuite are fixed.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">The notation <code>T U[N]</code> refers to an array called U containing N items of type
T. The type <code>opaque</code> means one single byte of uninterpreted data. Items of
the array are zero-indexed and referred as <code>U[j]</code> such that 0 &lt;= j &lt; N.
The notation <code>{T}</code> refers to a set consisting of elements of type <code>T</code>.
For any object <code>x</code>, we write <code>len(x)</code> to denote its length in bytes.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">String values such as "CredentialRequest", "CredentialResponse", "Presentation", and "Tag"
are ASCII string literals.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">The following terms are used throughout this document.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-7.1">
            <p id="section-2.1-7.1.1">Client: Protocol initiator. Creates a credential request, and uses the
corresponding server response to make a credential. The client can
make multiple presentations of this credential.<a href="#section-2.1-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-7.2">
            <p id="section-2.1-7.2.1">Server: Computes a response to a credential request, with its
server private keys. Later the server can verify the client's presentations
with its private keys. Learns nothing about the client's secret attributes,
and cannot link a client's request/response and presentation steps.<a href="#section-2.1-7.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="preliminaries">
<section id="section-3">
      <h2 id="name-preliminaries">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-preliminaries" class="section-name selfRef">Preliminaries</a>
      </h2>
<p id="section-3-1">The construction in this document has two primary dependencies:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">
          <p id="section-3-2.1.1"><code>Group</code>: A prime-order group implementing the API described below in <a href="#pog" class="auto internal xref">Section 3.1</a>.
See <a href="#ciphersuites" class="auto internal xref">Section 6</a> for specific instances of groups.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.2">
          <p id="section-3-2.2.1"><code>Hash</code>: A cryptographic hash function whose output length is <code>Nh</code> bytes.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-3-3"><a href="#ciphersuites" class="auto internal xref">Section 6</a> specifies ciphersuites as combinations of <code>Group</code> and <code>Hash</code>.<a href="#section-3-3" class="pilcrow">¶</a></p>
<div id="pog">
<section id="section-3.1">
        <h3 id="name-prime-order-group">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-prime-order-group" class="section-name selfRef">Prime-Order Group</a>
        </h3>
<p id="section-3.1-1">In this document, we assume the construction of an additive, prime-order
group <code>Group</code> for performing all mathematical operations. In prime-order groups,
any element (other than the identity) can generate the other elements of the
group. Usually, one element is fixed and defined as the group generator.
In the ARC setting, there are two fixed generator elements (generatorG, generatorH).
Such groups are uniquely determined by the choice of the prime <code>p</code> that defines the
order of the group. (There may, however, exist different representations
of the group for a single <code>p</code>. <a href="#ciphersuites" class="auto internal xref">Section 6</a> lists specific groups which
indicate both order and representation.)<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">The fundamental group operation is addition <code>+</code> with identity element
<code>I</code>. For any elements <code>A</code> and <code>B</code> of the group, <code>A + B = B + A</code> is
also a member of the group. Also, for any <code>A</code> in the group, there exists an element
<code>-A</code> such that <code>A + (-A) = (-A) + A = I</code>. Scalar multiplication by <code>r</code> is
equivalent to the repeated application of the group operation on an
element A with itself <code>r-1</code> times, this is denoted as <code>r*A = A + ... + A</code>.
For any element <code>A</code>, <code>p*A=I</code>. The case when the scalar multiplication is
performed on the group generator is denoted as <code>ScalarMultGen(r)</code>.
Given two elements A and B, the discrete logarithm problem is to find
an integer k such that B = k*A. Thus, k is the discrete logarithm of
B with respect to the base A.
The set of scalars corresponds to <code>GF(p)</code>, a prime field of order p, and are
represented as the set of integers defined by <code>{0, 1, ..., p-1}</code>.
This document uses types
<code>Element</code> and <code>Scalar</code> to denote elements of the group and its set of
scalars, respectively.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">We now detail a number of member functions that can be invoked on a
prime-order group.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">
            <p id="section-3.1-4.1.1">Order(): Outputs the order of the group (i.e. <code>p</code>).<a href="#section-3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.2">
            <p id="section-3.1-4.2.1">Identity(): Outputs the identity element of the group (i.e. <code>I</code>).<a href="#section-3.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.3">
            <p id="section-3.1-4.3.1">Generator(): Outputs the fixed generator of the group.<a href="#section-3.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.4">
            <p id="section-3.1-4.4.1">HashToGroup(x, info): Deterministically maps
an array of bytes <code>x</code> with domain separation value <code>info</code> to an element of <code>Group</code>. The map must ensure that,
for any adversary receiving <code>R = HashToGroup(x, info)</code>, it is
computationally difficult to reverse the mapping.
Security properties of this function are described
in <span>[<a href="#I-D.irtf-cfrg-hash-to-curve" class="cite xref">I-D.irtf-cfrg-hash-to-curve</a>]</span>.<a href="#section-3.1-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.5">
            <p id="section-3.1-4.5.1">HashToScalar(x, info): Deterministically maps
an array of bytes <code>x</code> with domain separation value <code>info</code> to an element in GF(p).
Security properties of this function are described in <span>[<a href="#I-D.irtf-cfrg-hash-to-curve" class="cite xref">I-D.irtf-cfrg-hash-to-curve</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hash-to-curve-16#section-10.5" class="relref">Section 10.5</a></span>.<a href="#section-3.1-4.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.6">
            <p id="section-3.1-4.6.1">RandomScalar(): Chooses at random a non-zero element in GF(p).<a href="#section-3.1-4.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.7">
            <p id="section-3.1-4.7.1">ScalarInverse(s): Returns the inverse of input <code>Scalar</code> <code>s</code> on <code>GF(p)</code>.<a href="#section-3.1-4.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.8">
            <p id="section-3.1-4.8.1">SerializeElement(A): Maps an <code>Element</code> <code>A</code>
to a canonical byte array <code>buf</code> of fixed length <code>Ne</code>.<a href="#section-3.1-4.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.9">
            <p id="section-3.1-4.9.1">DeserializeElement(buf): Attempts to map a byte array <code>buf</code> to
an <code>Element</code> <code>A</code>, and fails if the input is not the valid canonical byte
representation of an element of the group. This function can raise a
DeserializeError if deserialization fails or <code>A</code> is the identity element of
the group; see <a href="#ciphersuites" class="auto internal xref">Section 6</a> for group-specific input validation steps.<a href="#section-3.1-4.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.10">
            <p id="section-3.1-4.10.1">SerializeScalar(s): Maps a <code>Scalar</code> <code>s</code> to a canonical
byte array <code>buf</code> of fixed length <code>Ns</code>.<a href="#section-3.1-4.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.11">
            <p id="section-3.1-4.11.1">DeserializeScalar(buf): Attempts to map a byte array <code>buf</code> to a <code>Scalar</code> <code>s</code>.
This function can raise a DeserializeError if deserialization fails; see
<a href="#ciphersuites" class="auto internal xref">Section 6</a> for group-specific input validation steps.<a href="#section-3.1-4.11.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-5">For each group, there exists two distinct generators, generatorG and
generatorH, generatorG = G.Generator() and generatorH = G.HashToGroup(G.SerializeElement(generatorG), "generatorH").
The group member functions GeneratorG() and GeneratorH() are shorthand
for returning generatorG and generatorH, respectively.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6"><a href="#ciphersuites" class="auto internal xref">Section 6</a> contains details for the implementation of this interface
for different prime-order groups instantiated over elliptic curves.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="arc-protocol">
<section id="section-4">
      <h2 id="name-arc-protocol">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-arc-protocol" class="section-name selfRef">ARC Protocol</a>
      </h2>
<p id="section-4-1">The ARC protocol is a two-party protocol run between client and server
consisting of three distinct phases:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-2">
<li id="section-4-2.1">
          <p id="section-4-2.1.1">Key generation. In this phase, the server generates its private and public
keys to be used for the remaining phases. This phase is described in <a href="#setup" class="auto internal xref">Section 4.1</a>.<a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-4-2.2">
          <p id="section-4-2.2.1">Credential issuance. In this phase, the client and server interact to issue
the client a credential that is cryptographically bound to client secrets.
This phase is described in <a href="#issuance" class="auto internal xref">Section 4.2</a>.<a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-4-2.3">
          <p id="section-4-2.3.1">Presentation. In this phase, the client uses the credential to create a "presentation"
to the server, where the server learns nothing more than whether or not the
presentation is valid and corresponds to some previously issued credential,
without learning which credential it corresponds to. This phase is described
in <a href="#presentation" class="auto internal xref">Section 4.3</a>.<a href="#section-4-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-4-3">This protocol bears resemblance to anonymous token protocols, such as those built on
Blind RSA <span>[<a href="#BLIND-RSA" class="cite xref">BLIND-RSA</a>]</span> and Oblivious Pseudorandom Functions <span>[<a href="#OPRFS" class="cite xref">OPRFS</a>]</span>
with one critical distinction: Unlike anonymous tokens, an anonymous credential can be
used multiple times to create unlinkable presentations (up to the fixed presentation
limit). This means that a single issuance invocation can drive multiple presentation
invocations, whereas with anonymous tokens, each presentation invocation requires
exactly one issuance invocation. As a result, credentials are generally longer lived
than tokens. Applications configure the credential presentation limit after the
credential is issued such that client and server agree on the limit during presentation.
Servers are responsible for ensuring this limit is not exceeded. Clients that exceed
the agreed-upon presentation limit break the unlinkability guarantees provided by
the protocol.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">The rest of this section describes the three phases of the ARC protocol.<a href="#section-4-4" class="pilcrow">¶</a></p>
<div id="setup">
<section id="section-4.1">
        <h3 id="name-key-generation">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-key-generation" class="section-name selfRef">Key Generation</a>
        </h3>
<p id="section-4.1-1">In the key generation phase, the server generates its private and public
keys, denoted ServerPrivateKey and ServerPublicKey, as follows.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-2">
<pre>
Input: None
Output:
- ServerPrivateKey:
  - x0: Scalar
  - x1: Scalar
  - x2: Scalar
  - x0Blinding: Scalar
- ServerPublicKey:
  - X0: Element
  - X1: Element
  - X2: Element

Parameters
- Group G

def SetupServer():
  x0 = G.RandomScalar()
  x1 = G.RandomScalar()
  x2 = G.RandomScalar()
  x0Blinding = G.RandomScalar()
  X0 = x0 * G.GeneratorG() + x0Blinding * G.GeneratorH()
  X1 = x1 * G.GeneratorH()
  X2 = x2 * G.GeneratorH()
  return ServerPrivateKey(x0, x1, x2, x0Blinding), ServerPublicKey(X0, X1, X2)
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">The server public keys can be serialized as follows:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-4">
<pre>
struct {
  uint8 X0[Ne]; // G.SerializeElement(X0)
  uint8 X1[Ne]; // G.SerializeElement(X1)
  uint8 X2[Ne]; // G.SerializeElement(X2)
} ServerPublicKey;
</pre><a href="#section-4.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1-5">The length of this encoded response structure is <code>NserverPublicKeys = 3*Ne</code>.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="issuance">
<section id="section-4.2">
        <h3 id="name-issuance">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-issuance" class="section-name selfRef">Issuance</a>
        </h3>
<p id="section-4.2-1">The purpose of the issuance phase is for the client and server to cooperatively compute a credential
that is cryptographically bound to the client's secrets. Clients do not choose these secrets;
they are computed by the protocol.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">The issuance phase of the protocol requires clients to know the server public key a priori, as well as
an arbitrary, application-specific request context. It requires no other input. It consists of three
distinct steps:<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2-3">
<li id="section-4.2-3.1">
            <p id="section-4.2-3.1.1">The client generates and sends a credential request to the server. This credential request contains a
proof that the request is valid with respect to the client's secrets and request context. See
<a href="#issuance-step1" class="auto internal xref">Section 4.2.1</a> for details about this step.<a href="#section-4.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.2-3.2">
            <p id="section-4.2-3.2.1">The server validates the credential request. If valid, computes a credential response with the server
private keys. The response includes a proof that the credential response is valid with respect to the
server keys. The server sends the response to the client. See <a href="#issuance-step2" class="auto internal xref">Section 4.2.2</a> for details about this
step.<a href="#section-4.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.2-3.3">
            <p id="section-4.2-3.3.1">The client finalizes the credential by processing the server response. If valid, this step yields a
credential that can then be used in the presentation phase of the protocol. See <a href="#issuance-step3" class="auto internal xref">Section 4.2.3</a> for
details about this step.<a href="#section-4.2-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.2-4">Each of these steps are described in the following subsections.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<div id="issuance-step1">
<section id="section-4.2.1">
          <h4 id="name-credential-request">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-credential-request" class="section-name selfRef">Credential Request</a>
          </h4>
<p id="section-4.2.1-1">Given a request context, the process for creating a credential request is as follows:<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.1-2">
<pre>
(clientSecrets, request) = CredentialRequest(requestContext)

Inputs:
- requestContext: Data, context for the credential request

Outputs:
- request:
  - m1Enc: Element, first encrypted secret.
  - m2Enc: Element, second encrypted secret.
  - requestProof: ZKProof, a proof of correct generation of m1Enc and m2Enc.
- clientSecrets:
  - m1: Scalar, first secret.
  - m2: Scalar, second secret.
  - r1: Scalar, blinding factor for first secret.
  - r2: Scalar, blinding factor for second secret.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()

def CredentialRequest(requestContext):
  m1 = G.RandomScalar()
  m2 = G.HashToScalar(requestContext, "requestContext")
  r1 = G.RandomScalar()
  r2 = G.RandomScalar()
  m1Enc = m1 * generatorG + r1 * generatorH
  m2Enc = m2 * generatorG + r2 * generatorH
  requestProof = MakeCredentialRequestProof(m1, m2, r1, r2, m1Enc, m2Enc)
  request = (m1Enc, m2Enc, requestProof)
  clientSecrets = (m1, m2, r1, r2)
  return (clientSecrets, request)
</pre><a href="#section-4.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2.1-3">See <a href="#request-proof" class="auto internal xref">Section 5.2</a> for more details on the generation of the credential request proof.<a href="#section-4.2.1-3" class="pilcrow">¶</a></p>
<p id="section-4.2.1-4">The resulting request can be serialized as follows.<a href="#section-4.2.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.1-5">
<pre>
struct {
  uint8 m1Enc[Ne];
  uint8 m2Enc[Ne];
  uint8 challenge[Ns];
  uint8 response0[Ns];
  uint8 response1[Ns];
  uint8 response2[Ns];
  uint8 response3[Ns];
} CredentialRequest;
</pre><a href="#section-4.2.1-5" class="pilcrow">¶</a>
</div>
<p id="section-4.2.1-6">The length of this encoded request structure is <code>Nrequest = 2*Ne + 5*Ns</code>.<a href="#section-4.2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="issuance-step2">
<section id="section-4.2.2">
          <h4 id="name-credential-response">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-credential-response" class="section-name selfRef">Credential Response</a>
          </h4>
<p id="section-4.2.2-1">Given a credential request and server public and private keys, the process
for creating a credential response is as follows.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<div class="breakable lang-psuedocode sourcecode" id="section-4.2.2-2">
<pre>
response = CredentialResponse(serverPrivateKey, serverPublicKey, request)

Inputs:
- serverPrivateKey:
  - x0: Scalar (private), server private key 0.
  - x1: Scalar (private), server private key 1.
  - x2: Scalar (private), server private key 2.
  - x0Blinding: Scalar (private), blinding value for x0.
- serverPublicKey:
  - X0: Element, server public key 0.
  - X1: Element, server public key 1.
  - X2: Element, server public key 2.
- request:
  - m1Enc: Element, first encrypted secret.
  - m2Enc: Element, second encrypted secret.
  - responseProof: ZKProof, a proof of correct generation of m1Enc and m2Enc.

Outputs:
- U: Element, a randomized generator for the response, `b*G`.
- encUPrime: Element, encrypted UPrime.
- X0Aux: Element, auxiliary point for X0.
- X1Aux: Element, auxiliary point for X1.
- X2Aux: Element, auxiliary point for X2.
- HAux: Element, auxiliary point for generatorH.
- responseProof: ZKProof, a proof of correct generation of
  U, encUPrime, server public keys, and auxiliary points.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()

Exceptions:
- VerifyError, raised when response verification fails

def CredentialResponse(serverPrivateKeys, serverPublicKeys, request):
  if VerifyCredentialRequestProof(request) == false:
    raise VerifyError

  b = G.RandomScalar()
  U = b * generatorG
  encUPrime = b * (serverPublicKeys.X0 +
        serverPrivateKeys.x1 * request.m1Enc +
        serverPrivateKeys.x2 * request.m2Enc)
  X0Aux = b * serverPrivateKeys.x0Blinding * generatorH
  X1Aux = b * serverPublicKeys.X1
  X2Aux = b * serverPublicKeys.X2
  HAux = b * generatorH

  responseProof = MakeCredentialResponseProof(serverPrivateKeys,
    serverPublicKeys, request, b, U, encUPrime, X0Aux, X1Aux, X2Aux, HAux)
  return (U, encUPrime, X0Aux, X1Aux, X2Aux, HAux, responseProof)
</pre><a href="#section-4.2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2-3">The resulting response can be serialized as follows. See <a href="#response-proof" class="auto internal xref">Section 5.3</a> for more details on the generation of the credential response proof.<a href="#section-4.2.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.2-4">
<pre>
struct {
  uint8 U[Ne];
  uint8 encUPrime[Ne];
  uint8 X0Aux[Ne];
  uint8 X1Aux[Ne];
  uint8 X2Aux[Ne];
  uint8 HAux[Ne];
  uint8 challenge[Ns];
  uint8 response0[Ns];
  uint8 response1[Ns];
  uint8 response2[Ns];
  uint8 response3[Ns];
  uint8 response4[Ns];
  uint8 response5[Ns];
  uint8 response6[Ns];
}
</pre><a href="#section-4.2.2-4" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2-5">The length of this encoded response structure is <code>Nresponse = 6*Ne + 8*Ns</code>.<a href="#section-4.2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="issuance-step3">
<section id="section-4.2.3">
          <h4 id="name-finalize-credential">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-finalize-credential" class="section-name selfRef">Finalize Credential</a>
          </h4>
<p id="section-4.2.3-1">Given a credential request and response, server public keys, and the client
secrets produced when creating a credential request, the process for
finalizing the issuance flow and creating a credential is as follows.<a href="#section-4.2.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.3-2">
<pre>
credential = FinalizeCredential(clientSecrets, serverPublicKey, request, response)

Inputs:
- clientSecrets:
  - m1: Scalar, first secret.
  - m2: Scalar, second secret.
  - r1: Scalar, blinding factor for first secret.
  - r2: Scalar, blinding factor for second secret.
- serverPublicKey: ServerPublicKey, shared with the client out-of-band
- request:
  - m1Enc: Element, first encrypted secret.
  - m2Enc: Element, second encrypted secret.
  - requestProof: ZKProof, a proof of correct generation of m1Enc and m2Enc.
- response:
  - U: Element, a randomized generator for the response. `b*G`.
  - encUPrime: Element, encrypted UPrime.
  - X0Aux: Element, auxiliary point for X0.
  - X1Aux: Element, auxiliary point for X1.
  - X2Aux: Element, auxiliary point for X2.
  - HAux: Element, auxiliary point for generatorH.
  - responseProof: ZKProof, a proof of correct generation of U, encUPrime, server public keys, and auxiliary points.

Outputs:
- credential:
  - m1: Scalar, client's first secret.
  - U: Element, a randomized generator for the response. `b*G`.
  - UPrime: Element, the MAC over the server's private keys and the client's secret secrets.
  - X1: Element, server public key 1.

Exceptions:
- VerifyError, raised when response verification fails

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()

def FinalizeCredential(clientSecrets, serverPublicKey, request, response):
  if VerifyCredentialResponseProof(serverPublicKey, response, request) == false:
    raise VerifyError
  UPrime = response.encUPrime - response.X0Aux - clientSecrets.r1 * response.X1Aux - clientSecrets.r2 * response.X2Aux
  return (clientSecrets.m1, response.U, UPrime, serverPublicKey.X1)
</pre><a href="#section-4.2.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="presentation">
<section id="section-4.3">
        <h3 id="name-presentation">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-presentation" class="section-name selfRef">Presentation</a>
        </h3>
<p id="section-4.3-1">The purpose of the presentation phase is for the client to create a "presentation" to the server
which can be verified using the server private key. This phase is non-interactive, i.e., there is
no state stored between client and server in order to produce and then verify a presentation.
Client and server agree upon a fixed limit of presentations in order to create and verify
presentations; presentations will not verify correctly if the client and server use different
limits.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">This phase consists of three steps:<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3-3">
<li id="section-4.3-3.1">
            <p id="section-4.3-3.1.1">The client creates presentation state for a given presentation context and presentation limit.
This state is used to produce a fixed amount of presentations.<a href="#section-4.3-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.3-3.2">
            <p id="section-4.3-3.2.1">The client creates a presentation from the presentation state and sends it to the server.
The presentation is cryptographically bound to the state's presentation context, and
contains proof that the presentation is valid with respect to the presentation context.
Moreover, the presentation contains proof that the count of this presentation is within the
presentation limit.<a href="#section-4.3-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.3-3.3">
            <p id="section-4.3-3.3.1">The server verifies the presentation with respect to the presentation context and fixed-size
limit.<a href="#section-4.3-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.3-4">Details for each each of these steps are in the following subsections.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="presentation-state">
<section id="section-4.4">
        <h3 id="name-presentation-state">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-presentation-state" class="section-name selfRef">Presentation State</a>
        </h3>
<p id="section-4.4-1">Presentation state is used to track the number of presentations for a given credential.
This state is important for ARC's unlinkability goals: reuse of state can break
unlinkability properties of credential presentations. State is initialized
with a credential, presentation context, and presentation limit. It is then mutated
after each presentation construction (as described in <a href="#presentation-construction" class="auto internal xref">Section 4.5</a>).<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-2">
<pre>
state = MakePresentationState(credential, presentationContext, presentationLimit)

Inputs:
- credential:
  - m1: Scalar, client's first secret.
  - U: Element, a randomized generator for the response `b*G`.
  - UPrime: Element, the MAC over the server's private keys and the client's secrets.
  - X1: Element, server public key 1.
- presentationContext: Data (public), used for presentation tag computation.
- presentationLimit: Integer, the fixed presentation limit.

Outputs:
- credential
- presentationContext: Data (public), used for presentation tag computation.
- presentationNonceSet: {Integer}, the set of nonces that have been used for this presentation
- presentationNonce: Integer, the number of times this credential has been presented for this presentationContext, initialized to 0.
- presentationLimit: Integer, the fixed presentation limit.

def MakePresentationState(credential, presentationContext, presentationLimit):
  nonce = random_integer_uniform(0, presentationLimit)
  return PresentationState(credential, presentationContext, nonce, presentationLimit)
</pre><a href="#section-4.4-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4-3">Applications which initialize more than one presentation state for the same presentation
context<a href="#section-4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="presentation-construction">
<section id="section-4.5">
        <h3 id="name-presentation-construction">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-presentation-construction" class="section-name selfRef">Presentation Construction</a>
        </h3>
<p id="section-4.5-1">Creating a presentation requires a credential, presentation context, and presentation limit.
This process is necessarily stateful on the client since the number of times a credential
is used for a given presentation context cannot exceed the presentation limit; doing so
would break presentation unlinkability, as two presentations created with the same "counter"
can be directly compared for equality (via the "tag"). As a result, the process for creating
a presentation accepts as input a presentation count and then outputs an updated presentation
count.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-2">
<pre>
newState, presentation = Present(state)

Inputs:
state: input PresentationState
  - credential
  - presentationContext: Data (public), used for presentation tag computation.
  - presentationCount: Integer, the number of times this credential has been presented for this presentationContext, initialized to 0.
  - presentationLimit: Integer, the fixed presentation limit.

Outputs:
- newState: updated PresentationState
- presentation:
  - U: Element, re-randomized from the U in the response.
  - UPrimeCommit: Element, a public key to the issued UPrime.
  - m1Commit: Element, a public key to the client secret (m1).
  - nonce: Integer, the nonce associated with this presentation.
  - tag: Element, the tag element used for enforcing rate limiting and reuse.
  - presentationProof: ZKProof, a proof of correct generation of the presentation.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()

Exceptions:
- LimitExceededError, raised when the presentation count meets or exceeds the presentation limit for the given presentation context

def Present(state):
  if state.presentationCount &gt;= state.presentationLimit:
    raise LimitExceededError

  a = G.RandomScalar()
  r = G.RandomScalar()
  z = G.RandomScalar()

  U = a * state.credential.U
  UPrime = a * state.credential.UPrime
  UPrimeCommit = UPrime + r * generatorG
  m1Commit = state.credential.m1 * U + z * generatorH

  # This step mutates the state by keeping track of
  # what nonces have already been spent.
  nonce = state.presentationNonce
  state.presentationNonceSet.add(nonce)
  state.presentationNonce = random_integer_uniform_excluding_set(0,
    state.presentationLimit, state.presentationNonceSet)

  generatorT = G.HashToGroup(presentationContext, "Tag")
  tag = (credential.m1 + nonce)^(-1) * generatorT
  V = z * credential.X1 - r * generatorG
  m1Tag = state.credential.m1 * tag

  presentationProof = MakePresentationProof(U, UPrimeCommit, m1Commit, tag, generatorT, credential, V, r, z, nonce, m1Tag)

  presentation = (U, UPrimeCommit, m1Commit, nonce, tag, presentationProof)

  return state, presentation
</pre><a href="#section-4.5-2" class="pilcrow">¶</a>
</div>
<p id="section-4.5-3">[[OPEN ISSUE: should the tag also fold in the presentation limit?]]<a href="#section-4.5-3" class="pilcrow">¶</a></p>
<p id="section-4.5-4">The resulting presentation can be serialized as follows. See <a href="#presentation-proof" class="auto internal xref">Section 5.4</a>
for more details on the generation of the presentation proof.<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-5">
<pre>
struct {
  uint8 U[Ne];
  uint8 UPrimeCommit[Ne];
  uint8 m1Commit[Ne];
  uint8 tag[Ne];
  uint8 challenge[Ns];
  uint8 response0[Ns];
  uint8 response1[Ns];
  uint8 response2[Ns];
  uint8 response3[Ns];
  uint8 response4[Ns];
}
</pre><a href="#section-4.5-5" class="pilcrow">¶</a>
</div>
<p id="section-4.5-6">The length of this structure is <code>Npresentation = 4*Ne + 4*Ns</code>, plus the length of the serialized range proof.<a href="#section-4.5-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="presentation-verification">
<section id="section-4.6">
        <h3 id="name-presentation-verification">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-presentation-verification" class="section-name selfRef">Presentation Verification</a>
        </h3>
<p id="section-4.6-1">The server processes the presentation by verifying the presentation proof against server-computed
values, and performing a check that the presentation is in .<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.6-2">
<pre>
validity = VerifyPresentation(serverPrivateKey, serverPublicKey, requestContext, presentationContext, presentation, presentationLimit)

Inputs:
- serverPrivateKey:
  - x0: Scalar (private), server private key 0.
  - x1: Scalar (private), server private key 1.
  - x2: Scalar (private), server private key 2.
  - x0Blinding: Scalar (private), blinding value for x0.
- serverPublicKey:
  - X0: Element, server public key 0.
  - X1: Element, server public key 1.
  - X2: Element, server public key 2.
- requestContext: Data, context for the credential request.
- presentationContext: Data (public), used for presentation tag computation.
- presentation:
  - U: Element, re-randomized from the U in the response.
  - UPrimeCommit: Element, a public key to the issued UPrime.
  - m1Commit: Element, a public key to the client secret (m1).
  - nonce: Integer, the nonce associated with this presentation.
  - tag: Element, the tag element used for enforcing rate limiting and reuse.
  - presentationProof: ZKProof, a proof of correct generation of the presentation.
- presentationLimit: Integer, the fixed presentation limit.

Outputs:
- validity: Boolean, True if the presentation is valid, False otherwise.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()

Exceptions:
- InvalidNonceError, raised when the nonce associated with the presentation is invalid

def VerifyPresentation(serverPrivateKey, serverPublicKey, requestContext, presentationContext, presentation, presentationLimit):
  if presentation.nonce &lt; 0 or presentation.nonce &gt; presentationLimit:
    raise InvalidNonceError

  generatorT = G.HashToGroup(presentationContext, "Tag")
  m1Tag = generator_T - (presentation.nonce * presentation.tag)

  validity = VerifyPresentationProof(serverPrivateKey, serverPublicKey, requestContext, presentationContext, presentation, m1Tag)
  # Implementation-specific step: perform double-spending check on tag.
  # Implementation-specific step: store tag for future double-spending check.
  return validity
</pre><a href="#section-4.6-2" class="pilcrow">¶</a>
</div>
<p id="section-4.6-3">Implementation-specific steps: the server must perform a check that the tag (presentation.tag) has
not previously been seen, to prevent double spending. It then stores the tag for use in future double
spending checks. To reduce the overhead of performing double spend checks, the server can store and
look up the tags corresponding to the associated presentationContext value.<a href="#section-4.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="zero-knowledge-proofs">
<section id="section-5">
      <h2 id="name-zero-knowledge-proofs">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-zero-knowledge-proofs" class="section-name selfRef">Zero-Knowledge Proofs</a>
      </h2>
<p id="section-5-1">This section describes a Schnorr proof compiler that is used for the construction of other proofs needed throughout
the ARC protocol. <a href="#compiler" class="auto internal xref">Section 5.1</a> describes the compiler, and the remaining sections describe how it is used for
the purposes of producing ARC proofs.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="compiler">
<section id="section-5.1">
        <h3 id="name-schnorr-compiler">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-schnorr-compiler" class="section-name selfRef">Schnorr Compiler</a>
        </h3>
<p id="section-5.1-1">The compiler specified in this section automates the Fiat-Shamir transform that is often used to
transform interactive zero-knowledge proofs into non-interactive proofs such that they can be used
to non-interactively prove various statements of importance in higher-level protocols, such as ARC.
The compiler consists of a prover and verifier role. The prover constructs a transcript for the
proof and then applies the Fiat-Shamir heuristic to generate the resulting challenge and response
values. The verifier reconstructs the same transcript to verify the proof.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The prover and verifier roles are specified below in <a href="#prover" class="auto internal xref">Section 5.1.1</a> and <a href="#verifier" class="auto internal xref">Section 5.1.2</a>, respectively.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<div id="prover">
<section id="section-5.1.1">
          <h4 id="name-prover">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-prover" class="section-name selfRef">Prover</a>
          </h4>
<p id="section-5.1.1-1">The prover role consists of four functions:<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.1-2.1">
              <p id="section-5.1.1-2.1.1">AppendScalar: This function adds a scalar representation to the transcript.<a href="#section-5.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-2.2">
              <p id="section-5.1.1-2.2.1">AppendElement: This function adds an element representation to the transcript.<a href="#section-5.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-2.3">
              <p id="section-5.1.1-2.3.1">Constrain: This function applies an explicit constraint to the proof, where the constraint is expressed as equality between some element and a linear combination of scalar and element representations. An example constraint might be <code>y = mx + b</code>, for scalar <code>m</code> and elements
<code>y</code>, <code>x</code>, and <code>b</code>.<a href="#section-5.1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-2.4">
              <p id="section-5.1.1-2.4.1">Prove: This function applies the Fiat-Shamir heuristic to the protocol transcript and set of
constraints to produce a zero-knowledge proof that can be verified.<a href="#section-5.1.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.1-3">These functions are defined in the following sub-sections.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4">In addition, the prover role consists of the following state:<a href="#section-5.1.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.1-5.1">
              <p id="section-5.1.1-5.1.1">label: Data, a value representing the context in which the proof will be used<a href="#section-5.1.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-5.2">
              <p id="section-5.1.1-5.2.1">scalars: [Integer], An ordered set of representation of scalar variables to use in the proof. Each scalar has a label associated with it, stored in a list called <code>scalar_labels</code>.<a href="#section-5.1.1-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-5.3">
              <p id="section-5.1.1-5.3.1">elements: [Integer], An ordered set of representation of element variables to use in the proof. Each element has a label associated with it, stored in a list called <code>element_labels</code>.<a href="#section-5.1.1-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-5.4">
              <p id="section-5.1.1-5.4.1">constraints: a set of constraints, where each constraint consists of a constraint element and a linear combination of variables.<a href="#section-5.1.1-5.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div id="appendscalar">
<section id="section-5.1.1.1">
            <h5 id="name-appendscalar">
<a href="#section-5.1.1.1" class="section-number selfRef">5.1.1.1. </a><a href="#name-appendscalar" class="section-name selfRef">AppendScalar</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-5.1.1.1-1">
<pre>
AppendScalar(label, assignment)

Inputs:
- label: Data, Scalar variable label
- assignment: Scalar variable

Outputs:
- Integer: Integer representation of the new scalar variable

def AppendScalar(label, assignment):
  state.scalars.append(assignment)
  state.scalar_labels.append(label)
  return len(state.scalars) - 1
</pre><a href="#section-5.1.1.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="appendelement">
<section id="section-5.1.1.2">
            <h5 id="name-appendelement">
<a href="#section-5.1.1.2" class="section-number selfRef">5.1.1.2. </a><a href="#name-appendelement" class="section-name selfRef">AppendElement</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-5.1.1.2-1">
<pre>
AppendElement(label, assignment)

Inputs:
- label: Data, Element variable label
- assignment: Element variable

Outputs:
- Integer: Integer representation of the new element variable

def AppendElement(label, assignment):
  state.elements.append(assignment)
  state.element_labels.append(label)
  return len(state.elements) - 1
</pre><a href="#section-5.1.1.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="constrain">
<section id="section-5.1.1.3">
            <h5 id="name-constrain">
<a href="#section-5.1.1.3" class="section-number selfRef">5.1.1.3. </a><a href="#name-constrain" class="section-name selfRef">Constrain</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-5.1.1.3-1">
<pre>
Constrain(result, linearCombination)

Inputs:
- result: Integer, representation of constraint element
- assignment: linear combination of scalar and element variable (representations)

def Constrain(label, linearCombination):
  state.constraints.append((result, linearCombination))
</pre><a href="#section-5.1.1.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="prove">
<section id="section-5.1.1.4">
            <h5 id="name-prove">
<a href="#section-5.1.1.4" class="section-number selfRef">5.1.1.4. </a><a href="#name-prove" class="section-name selfRef">Prove</a>
            </h5>
<p id="section-5.1.1.4-1">The Prove function is defined below.<a href="#section-5.1.1.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1.1.4-2">
<pre>
Prove()

Outputs:
- ZKProof, a proof consisting of a challenge Scalar and then fixed number of response Scalar values

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()

Exceptions:
- InvalidVariableAllocationError, raised when the prover was incorrectly configured

def Prove():
  blindings = [G.RandomScalar() for i in range(len(state.scalars))]

  blinded_elements = []
  for (constraint_point, linear_combination) in state.constraints:
    if constraint_point.index &gt; len(state.elements):
      raise InvalidVariableAllocationError

    for (scalar_var, element_var) in linear_combination:
      if scalar_var.index &gt; len(state.scalars):
        raise InvalidVariableAllocationError
      if element_var.index &gt; len(state.elements):
        raise InvalidVariableAllocationError

    scalar_index = linear_combination[0][0]
    element_index = linear_combination[0][1]
    blinded_element = blindings[scalar_index] * state.elements[element_index]

    for i, pair in enumerate(linear_combination):
      if i &gt; 0:
        scalar_index = pair[0]
        element_index = pair[1]
        blinded_element += blindings[scalar_index] * state.elements[element_index]

        blinded_elements.append(blinded_element)

  # Obtain a scalar challenge
  challenge = ComposeChalenge(state.label, state.elements, blinded_elements)

  # Compute response scalars from the challenge, scalars, and blindings.
  responses = []
  for (index, scalar) in enumerate(state.scalars):
    blinding = blindings[index]
    responses.append(blinding - challenge * scalar)

  return ZKProof(challenge, responses)
</pre><a href="#section-5.1.1.4-2" class="pilcrow">¶</a>
</div>
<p id="section-5.1.1.4-3">The function ComposeChalenge is defined below.<a href="#section-5.1.1.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1.1.4-4">
<pre>
ComposeChalenge(label, elements, blinded_elements)

Inputs:
- label: Data, the proof label
- elements: [Element], ordered list of elements
- blinded_elements: [Element], ordered list of blinded elements

Outputs:
- challenge, Scalar

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()

def ComposeChallenge(label, elements, blinded_elements):
  challenge_input = Data() # Empty Data

  for element in elements:
    serialized_element = G.SerializeElement(element)
    challenge_input += I2OSP(len(serialized_element), 2) + serialized_element

  for blinded_element in blinded_elements:
    serialized_blinded_element = G.SerializeElement(blinded_element)
    challenge_input += I2OSP(len(serialized_blinded_element), 2) + serialized_blinded_element

  return G.HashToScalar(challenge_input, label)
</pre><a href="#section-5.1.1.4-4" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="verifier">
<section id="section-5.1.2">
          <h4 id="name-verifier">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-verifier" class="section-name selfRef">Verifier</a>
          </h4>
<p id="section-5.1.2-1">The verifier role consists of four functions:<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-2.1">
              <p id="section-5.1.2-2.1.1">AppendScalar: This function adds a scalar representation to the transcript.<a href="#section-5.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.2-2.2">
              <p id="section-5.1.2-2.2.1">AppendElement: This function adds an element representation to the transcript.<a href="#section-5.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.2-2.3">
              <p id="section-5.1.2-2.3.1">Constrain: This function applies an explicit constraint to the proof, where the constraint is expressed as equality between some element and a linear combination of scalar and element representations. An example constraint might be <code>y = mx + b</code>, for scalar <code>m</code> and elements
<code>y</code>, <code>x</code>, and <code>b</code>.<a href="#section-5.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.2-2.4">
              <p id="section-5.1.2-2.4.1">Verify: This function applies the Fiat-Shamir heuristic to verify the zero-knowledge proof.<a href="#section-5.1.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.2-3">AppendScalar and Verify are defined in the following sub-sections. AppendElement and Constrain matches the functionality used in the prover role.<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<div id="appendscalar-1">
<section id="section-5.1.2.1">
            <h5 id="name-appendscalar-2">
<a href="#section-5.1.2.1" class="section-number selfRef">5.1.2.1. </a><a href="#name-appendscalar-2" class="section-name selfRef">AppendScalar</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-5.1.2.1-1">
<pre>
AppendScalar(label)

Inputs:
- label: Data, Scalar variable label

Outputs:
- Integer: Integer representation of the new scalar variable

def AppendScalar(label):
  state.scalar_labels.append(label)
  return len(state.scalar_labels) - 1
</pre><a href="#section-5.1.2.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="verify">
<section id="section-5.1.2.2">
            <h5 id="name-verify">
<a href="#section-5.1.2.2" class="section-number selfRef">5.1.2.2. </a><a href="#name-verify" class="section-name selfRef">Verify</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-5.1.2.2-1">
<pre>
Verify(proof)

Inputs:
- ZKProof, a proof consisting of a challenge Scalar and then fixed number of response Scalar values

Outputs:
- Boolean, True if the proof is valid, False otherwise.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()

Exceptions:
- InvalidVariableAllocationError, raised when the prover was incorrectly configured

def Verify(proof):
  if len(state.elements) != len(state.element_labels):
    raise InvalidVariableAllocationError

  blinded_elements = []
  for (constraint_element, linear_combination) in state.constraints:
    if constraint_element &gt; len(state.elements):
      raise InvalidVariableAllocationError
    for (_, element_var) in linear_combination:
      if element_var &gt; len(state.elements):
        raise InvalidVariableAllocationError

    challenge_element = proof.challenge * state.elements[constraint_element]
    for i, pair in enumerate(linear_combination):
      challenge_element += proof.responses[pair[0]] * state.elements[pair[1]]

    blinded_elements.append(challenge_element)

  challenge = ComposeChallenge(state.label, self.elements, blinded_elements)
  return challenge == proof.challenge
</pre><a href="#section-5.1.2.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="request-proof">
<section id="section-5.2">
        <h3 id="name-credentialrequest-proof">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-credentialrequest-proof" class="section-name selfRef">CredentialRequest Proof</a>
        </h3>
<p id="section-5.2-1">The request proof is a proof of knowledge of (m1, m2, r1, r2) used to generate the encrypted request. Statements to prove:<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-2">
<pre>
1. m1Enc = m1 * generatorG + r1 * generatorH
2. m2Enc = m2 * generatorG + r2 * generatorH
</pre><a href="#section-5.2-2" class="pilcrow">¶</a>
</div>
<div id="credentialrequest-proof-creation">
<section id="section-5.2.1">
          <h4 id="name-credentialrequest-proof-cre">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-credentialrequest-proof-cre" class="section-name selfRef">CredentialRequest Proof Creation</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.2.1-1">
<pre>
requestProof = MakeCredentialRequestProof(m1, m2, r1, r2, m1Enc, m2Enc)

Inputs:
- m1: Scalar, first secret.
- m2: Scalar, second secret.
- r1: Scalar, blinding factor for first secret.
- r2: Scalar, blinding factor for second secret.
- m1Enc: Element, first encrypted secret.
- m2Enc: Element, second encrypted secret.

Outputs:
- proof: ZKProof
  - challenge: Scalar, the challenge used in the proof of valid encryption.
  - response0: Scalar, the response corresponding to m1.
  - response1: Scalar, the response corresponding to m2.
  - response2: Scalar, the response corresponding to r1.
  - response3: Scalar, the response corresponding to r2.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()
- contextString: public input

def MakeCredentialRequestProof(m1, m2, r1, r2, m1Enc, m2Enc):
  prover = Prover(contextString + "CredentialRequest")

  m1Var = prover.AppendScalar("m1", m1)
  m2Var = prover.AppendScalar("m2", m2)
  r1Var = prover.AppendScalar("r1", r1)
  r2Var = prover.AppendScalar("r2", r2)

  genGVar = prover.AppendElement("genG", generatorG)
  genHVar = prover.AppendElement("genH", generatorH)
  m1EncVar = prover.AppendElement("m1Enc", m1Enc)
  m2EncVar = prover.AppendElement("m2Enc", m2Enc)

  # 1. m1Enc = m1 * generatorG + r1 * generatorH
  prover.Constrain(m1EncVar, [(m1Var, genGVar), (r1Var, genHVar)])

  # 2. m2Enc = m2 * generatorG + r2 * generatorH
  prover.Constrain(m2EncVar, [(m2Var, genGVar), (r2Var, genHVar)])

  return prover.Prove()
</pre><a href="#section-5.2.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="credentialrequest-proof-verification">
<section id="section-5.2.2">
          <h4 id="name-credentialrequest-proof-ver">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-credentialrequest-proof-ver" class="section-name selfRef">CredentialRequest Proof Verification</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.2.2-1">
<pre>
validity = VerifyCredentialRequestProof(request)

Inputs:
- request:
  - m1Enc: Element, first encrypted secret.
  - m2Enc: Element, second encrypted secret.
  - requestProof: ZKProof, a proof of correct generation of m1Enc and m2Enc.

Outputs:
- validity: Boolean, True if the proof verifies correctly, False otherwise.

Parameters:
- G: group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()
- contextString: public input

def VerifyCredentialRequestProof(request):
  verifier = Verifier(contextString + "CredentialRequest")

  m1Var = verifier.AppendScalar("m1")
  m2Var = verifier.AppendScalar("m2")
  r1Var = verifier.AppendScalar("r1")
  r2Var = verifier.AppendScalar("r2")
  genGVar = verifier.AppendElement("genG", generatorG)
  genHVar = verifier.AppendElement("genH", generatorH)
  m1EncVar = verifier.AppendElement("m1Enc", request.m1Enc)
  m2EncVar = verifier.AppendElement("m2Enc", request.m2Enc)

  # 1. m1Enc = m1 * generatorG + r1 * generatorH
  verifier.Constrain(m1EncVar, [(m1Var, genGVar), (r1Var, genHVar)])

  # 2. m2Enc = m2 * generatorG + r2 * generatorH
  verifier.Constrain(m2EncVar, [(m2Var, genGVar), (r2Var, genHVar)])

  return verifier.Verify(request.proof)
</pre><a href="#section-5.2.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="response-proof">
<section id="section-5.3">
        <h3 id="name-creentialresponse-proof">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-creentialresponse-proof" class="section-name selfRef">CreentialResponse Proof</a>
        </h3>
<p id="section-5.3-1">The response proof is a proof of knowledge of (x0, x1, x2, x0Blinding, b) used in the server's CredentialResponse for the client's CredentialRequest. Statements to prove:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-2">
<pre>
1. X0 = x0 * generatorG + x0Blinding * generatorH
2. X1 = x1 * generatorH
3. X2 = x2 * generatorH
4. X0Aux = b * x0Blinding * generatorH
  4a. HAux = b * generatorH
  4b: X0Aux = x0Blinding * HAux (= b * x0Blinding * generatorH)
5. X1Aux = b * x1 * generatorH
  5a. X1Aux = b * X1 (X1 = x1 * generatorH)
  5b. X1Aux = t1 * generatorH (t1 = b * x1)
6. X2Aux = b * x2 * generatorH
  6a. X2Aux = b * X2 (X2 = x2 * generatorH)
  6b. X2Aux = t2 * generatorH (t2 = b * x2)
7. U = b * generatorG
8. encUPrime = b * (X0 + x1 * Enc(m1) + x2 * Enc(m2))
</pre><a href="#section-5.3-2" class="pilcrow">¶</a>
</div>
<div id="credentialresponse-proof-creation">
<section id="section-5.3.1">
          <h4 id="name-credentialresponse-proof-cr">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-credentialresponse-proof-cr" class="section-name selfRef">CredentialResponse Proof Creation</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.3.1-1">
<pre>
responseProof = MakeCredentialResponseProof(serverPrivateKey, serverPublicKey, request, b, U, encUPrime, X0Aux, X1Aux, X2Aux, HAux)

Inputs:
- serverPrivateKey:
  - x0: Scalar (private), server private key 0.
  - x1: Scalar (private), server private key 1.
  - x2: Scalar (private), server private key 2.
  - x0Blinding: Scalar (private), blinding value for x0.
- serverPublicKey:
  - X0: Element, server public key 0.
  - X1: Element, server public key 1.
  - X2: Element, server public key 2.
- request:
  - m1Enc: Element, first encrypted secret.
  - m2Enc: Element, second encrypted secret.
  - requestProof: ZKProof, a proof of correct generation of m1Enc and m2Enc.
- encUPrime: Element, encrypted UPrime.
- X0Aux: Element, auxiliary point for X0.
- X1Aux: Element, auxiliary point for X1.
- X2Aux: Element, auxiliary point for X2.
- HAux: Element, auxiliary point for generatorH.

Outputs:
- proof: ZKProof
  - challenge: Scalar, the challenge used in the proof of valid response.
  - response0: Scalar, the response corresponding to x0.
  - response1: Scalar, the response corresponding to x1.
  - response2: Scalar, the response corresponding to x2.
  - response3: Scalar, the response corresponding to x0Blinding.
  - response4: Scalar, the response corresponding to b.
  - response5: Scalar, the response corresponding to t1.
  - response6: Scalar, the response corresponding to t2.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()
- contextString: public input

def MakeCredentialResponseProof(serverPrivateKey, serverPublicKey, request, b, U, encUPrime, X0Aux, X1Aux, X2Aux, HAux):
  prover = Prover(contextString + "CredentialResponse")

  x0Var = prover.AppendScalar("x0", serverPrivateKey.x0)
  x1Var = prover.AppendScalar("x1", serverPrivateKey.x1)
  x2Var = prover.AppendScalar("x2", serverPrivateKey.x2)
  x0BlindingVar = prover.AppendScalar("x0Blinding", serverPrivateKey.x0Blinding)
  bVar = prover.AppendScalar("b", b)
  t1Var = prover.AppendScalar("t1", b * serverPrivateKey.x1)
  t2Var = prover.AppendScalar("t2", b * serverPrivateKey.x2)

  genGVar = prover.AppendElement("genG", generatorG)
  genHVar = prover.AppendElement("genH", generatorH)
  m1EncVar = prover.AppendElement("m1Enc", request.m1Enc)
  m2EncVar = prover.AppendElement("m2Enc", request.m2Enc)
  UVar = prover.AppendElement("U", U)
  encUPrimeVar = prover.AppendElement("encUPrime", encUPrime)
  X0Var = prover.AppendElement("X0", serverPublicKeys.X0)
  X1Var = prover.AppendElement("X1", serverPublicKeys.X1)
  X2Var = prover.AppendElement("X2", serverPublicKeys.X2)
  X0AuxVar = prover.AppendElement("X0Aux", X0Aux)
  X1AuxVar = prover.AppendElement("X1Aux", X1Aux)
  X2AuxVar = prover.AppendElement("X2Aux", X2Aux)
  HAuxVar = prover.AppendElement("HAux", HAux)

  # 1. X0 = x0 * generatorG + x0Blinding * generatorH
  prover.Constrain(X0Var, [(x0Var, genGVar), (x0BlindingVar, genHVar)])
  # 2. 2. X1 = x1 * generatorH
  prover.Constrain(X1Var, [(x1Var, genHVar)])
  # 3. X2 = x2 * generatorH
  prover.Constrain(X2Var, [(x2Var, genHVar)])

  # 4. X0Aux = b * x0Blinding * generatorH
  # 4a. HAux = b * generatorH
  prover.Constrain(HAuxVar, [(bVar, genHVar)])
  # 4b: X0Aux = x0Blinding * HAux (= b * x0Blinding * generatorH)
  prover.Constrain(X0AuxVar, [(x0BlindingVar, HAuxVar)])

  #5. X1Aux = b * x1 * generatorH
  # 5a. X1Aux = b * X1 (X1 = x1 * generatorH)
  prover.Constrain(X1AuxVar, [(t1Var, genHVar)])
  # 5b. X1Aux = t1 * generatorH (t1 = b * x1)
  prover.Constrain(X1AuxVar, [(bVar, X1Var)])

  # 6. X2Aux = b * x2 * generatorH
  # 6a. X2Aux = b * X2 (X2 = x2 * generatorH)
  prover.Constrain(X2AuxVar, [(bVar, X2Var)])
  # 6b. X2Aux = t2 * H (t2 = b * x2)
  prover.Constrain(X2AuxVar, [(t2Var, genHVar)])

  # 7. U = b * generatorG
  prover.Constrain(UVar, [(bVar, genGVar)])
  # 8. encUPrime = b * (X0 + x1 * Enc(m1) + x2 * Enc(m2))
  # simplified: encUPrime = b * X0 + t1 * m1Enc + t2 * m2Enc, since t1 = b * x1 and t2 = b * x2
  prover.Constrain(encUPrimeVar, [(bVar, X0Var), (t1Var, m1EncVar), (t2Var, m2EncVar)])

  return prover.Prove()
</pre><a href="#section-5.3.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="credentialresponse-proof-verification">
<section id="section-5.3.2">
          <h4 id="name-credentialresponse-proof-ve">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-credentialresponse-proof-ve" class="section-name selfRef">CredentialResponse Proof Verification</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.3.2-1">
<pre>
validity = VerifyCredentialResponseProof(serverPublicKey, response, request)

Inputs:
- serverPublicKey:
  - X0: Element, server public key 0.
  - X1: Element, server public key 1.
  - X2: Element, server public key 2.
- response:
  - U: Element, a randomized generator for the response. `b*G`.
  - encUPrime: Element, encrypted UPrime.
  - X0Aux: Element, auxiliary point for X0.
  - X1Aux: Element, auxiliary point for X1.
  - X2Aux: Element, auxiliary point for X2.
  - HAux: Element, auxiliary point for generatorH.
  - responseProof: ZKProof, a proof of correct generation of U, encUPrime, server public keys, and auxiliary points.
- request:
  - m1Enc: Element, first encrypted secret.
  - m2Enc: Element, second encrypted secret.
  - requestProof: ZKProof, a proof of correct generation of m1Enc and m2Enc.

Outputs:
- validity: Boolean, True if the proof verifies correctly, False otherwise.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()

def VerifyCredentialResponseProof(serverPublicKey, response, request):
  verifier = Verifier(contextString + "CredentialResponse")

  x0Var = verifier.AppendScalar("x0")
  x1Var = verifier.AppendScalar("x1")
  x2Var = verifier.AppendScalar("x2")
  x0BlindingVar = verifier.AppendScalar("x0Blinding")
  bVar = verifier.AppendScalar("b", b)
  t1Var = verifier.AppendScalar("t1")
  t2Var = verifier.AppendScalar("t2")

  genGVar = verifier.AppendElement("genG", generatorG)
  genHVar = verifier.AppendElement("genH", generatorH)
  m1EncVar = verifier.AppendElement("m1Enc", request.m1Enc)
  m2EncVar = verifier.AppendElement("m2Enc", request.m2Enc)
  UVar = verifier.AppendElement("U", response.U)
  encUPrimeVar = verifier.AppendElement("encUPrime", response.encUPrime)
  X0Var = verifier.AppendElement("X0", serverPublicKey.X0)
  X1Var = verifier.AppendElement("X1", serverPublicKey.X1)
  X2Var = verifier.AppendElement("X2", serverPublicKey.X2)
  X0AuxVar = verifier.AppendElement("X0Aux", response.X0Aux)
  X1AuxVar = verifier.AppendElement("X1Aux", response.X1Aux)
  X2AuxVar = verifier.AppendElement("X2Aux", response.X2Aux)
  HAuxVar = verifier.AppendElement("HAux", response.HAux)

  # 1. X0 = x0 * generatorG + x0Blinding * generatorH
  verifier.Constrain(X0Var, [(x0Var, genGVar), (x0BlindingVar, genHVar)])
  # 2. 2. X1 = x1 * generatorH
  verifier.Constrain(X1Var, [(x1Var, genHVar)])
  # 3. X2 = x2 * generatorH
  verifier.Constrain(X2Var, [(x2Var, genHVar)])

  # 4. X0Aux = b * x0Blinding * generatorH
  # 4a. HAux = b * generatorH
  verifier.Constrain(HAuxVar, [(bVar, genHVar)])
  # 4b: X0Aux = x0Blinding * HAux (= b * x0Blinding * generatorH)
  verifier.Constrain(X0AuxVar, [(x0BlindingVar, HAuxVar)])

  #5. X1Aux = b * x1 * generatorH
  # 5a. X1Aux = b * X1 (X1 = x1 * generatorH)
  verifier.Constrain(X1AuxVar, [(t1Var, genHVar)])
  # 5b. X1Aux = t1 * generatorH (t1 = b * x1)
  verifier.Constrain(X1AuxVar, [(bVar, X1Var)])

  # 6. X2Aux = b * x2 * generatorH
  # 6a. X2Aux = b * X2 (X2 = x2 * generatorH)
  verifier.Constrain(X2AuxVar, [(bVar, X2Var)])
  # 6b. X2Aux = t2 * H (t2 = b * x2)
  verifier.Constrain(X2AuxVar, [(t2Var, genHVar)])

  # 7. U = b * generatorG
  verifier.Constrain(UVar, [(bVar, genGVar)])
  # 8. encUPrime = b * (X0 + x1 * Enc(m1) + x2 * Enc(m2))
  # simplified: encUPrime = b * X0 + t1 * m1Enc + t2 * m2Enc, since t1 = b * x1 and t2 = b * x2
  verifier.Constrain(encUPrimeVar, [(bVar, X0Var), (t1Var, m1EncVar), (t2Var, m2EncVar)])

  return verifier.Verify(response.proof)
</pre><a href="#section-5.3.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="presentation-proof">
<section id="section-5.4">
        <h3 id="name-presentation-proof">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-presentation-proof" class="section-name selfRef">Presentation Proof</a>
        </h3>
<p id="section-5.4-1">The presentation proof is a proof of knowledge of (m1, r, z) used in the presentation, and a proof that the counter used to make the tag is in the range of [0, rateLimit).<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">Statements to prove:
~~~
1. m1Commit = m1 * U + z * generatorH
2. V = z * X1 - r * generatorG
3. G.HashToGroup(presentationContext, "Tag") = m1 * tag + counter * tag
4. m1Tag = m1 * tag
~~~<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<div id="presentation-proof-creation">
<section id="section-5.4.1">
          <h4 id="name-presentation-proof-creation">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-presentation-proof-creation" class="section-name selfRef">Presentation Proof Creation</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.4.1-1">
<pre>
presentationProof = MakePresentationProof(U, UPrimeCommit, m1Commit, tag, generatorT, credential, V, r, z, nonce, m1Tag)

Inputs:
- U: Element, re-randomized from the U in the response.
- UPrimeCommit: Element, a public key to the MACGGM output UPrime.
- m1Commit: Element, a public key to the client secret (m1).
- tag: Element, the tag element used for enforcing rate limiting and reuse.
- generatorT: Element, used for presentation tag computation.
- credential:
  - m1: Scalar, client's first secret.
  - U: Element, a randomized generator for the response. `b*G`.
  - UPrime: Element, the MAC over the server's private keys and the client's secrets.
  - X1: Element, server public key 1.
- V: Element, a proof helper element.
- r: Scalar (private), a randomly generated element used in presentation.
- z: Scalar (private), a randomly generated element used in presentation.
- nonce: Int, the nonce associated with the presentation.
- m1Tag: Element, helper element for the proof.

Outputs:
- proof: ZKProof
  - challenge: Scalar, the challenge used in the proof of valid presentation.
  - response0: Scalar, the response corresponding to m1.
  - response1: Scalar, the response corresponding to r.
  - response2: Scalar, the response corresponding to z.
  - response3: Scalar, the response corresponding to m1Tag.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()
- contextString: public input

def MakePresentationProof(U, UPrimeCommit, m1Commit, tag, generatorT, presentationContext, credential, V, r, z, nonce, m1Tag)
  prover = Prover(contextString + "PresentationProof")

  m1Var = prover.AppendScalar("m1", credential.m1)
  zVar = prover.AppendScalar("z", z)
  rNegVar = prover.AppendScalar("-r", -r)
  nonceVar = prover.AppendScalar("nonce", nonce)

  genGVar = prover.AppendElement("genG", generatorG)
  genHVar = prover.AppendElement("genH", generatorH)
  UVar = prover.AppendElement("U", U)
  _ = prover.AppendElement("UPrimeCommit", UPrimeCommit)
  m1CommitVar = prover.AppendElement("m1Commit", m1Commit)
  VVar = prover.AppendElement("V", V)
  X1Var = prover.AppendElement("X1", credential.X1)
  tagVar = prover.AppendElement("tag", tag)
  genTVar = prover.AppendElement("genT", generatorT)
  m1TagVar = prover.AppendElement("m1Tag", m1Tag)

  # 1. m1Commit = m1 * U + z * generatorH
  prover.Constrain(m1CommitVar, [(m1Var, UVar), (zVar, genHVar)])
  # 2. V = z * X1 - r * generatorG
  prover.Constrain(VVar, [(zVar, X1Var), (rNegVar, genGVar)])
  # 3. G.HashToGroup(presentationContext, "Tag") = m1 * tag + counter * tag
  prover.Constrain(genTVar, [(m1Var, tagVar), (nonceVar, tagVar)])
  # 4. m1Tag = m1 * tag
  prover.Constrain(m1TagVar, [(m1Var, tagVar)])

  return prover.Prove()
</pre><a href="#section-5.4.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="presentation-proof-verification">
<section id="section-5.4.2">
          <h4 id="name-presentation-proof-verifica">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-presentation-proof-verifica" class="section-name selfRef">Presentation Proof Verification</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.4.2-1">
<pre>
validity = VerifyPresentationProof(serverPrivateKey, serverPublicKey, requestContext, presentationContext, presentation, m1Tag)

Inputs:
- serverPrivateKey:
  - x0: Scalar (private), server private key 0.
  - x1: Scalar (private), server private key 1.
  - x2: Scalar (private), server private key 2.
  - x0Blinding: Scalar (private), blinding value for x0.
- serverPublicKey:
  - X0: Element, server public key 0.
  - X1: Element, server public key 1.
  - X2: Element, server public key 2.
- requestContext: Data, context for the credential request.
- presentationContext: Data (public), used for presentation tag computation.
- presentation:
  - U: Element, re-randomized from the U in the response.
  - UPrimeCommit: Element, a public key to the issued UPrime.
  - m1Commit: Element, a public key to the client secret (m1).
  - tag: Element, the tag element used for enforcing rate limiting and reuse.
  - presentationProof: ZKProof, a proof of correct generation of the presentation.
- m1Tag: Element, helper to validate the presentation proof.

Outputs:
- validity: Boolean, True if the proof verifies correctly, False otherwise.

Parameters:
- G: Group
- generatorG: Element, equivalent to G.GeneratorG()
- generatorH: Element, equivalent to G.GeneratorH()
- contextString: public input

def VerifyPresentationProof(serverPrivateKey, serverPublicKey, requestContext, presentationContext, presentation, m1Tag):
  m2 = G.HashToScalar(requestContext, "requestContext")
  V = serverPrivateKey.x0 * presentation.U + serverPrivateKey.x1 * presentation.m1Commit + serverPrivateKey.x2 * m2 * presentation.U - presentation.UPrimeCommit
  generatorT = G.HashToGroup(presentationContext, "Tag")

  verifier = Verifier(contextString + "PresentationProof")

  m1Var = verifier.AppendScalar("m1")
  zVar = verifier.AppendScalar("z")
  rNegVar = verifier.AppendScalar("-r")
  nonceVar = verifier.AppendScalar("nonce")

  genGVar = verifier.AppendElement("genG", generatorG)
  genHVar = verifier.AppendElement("genH", generatorH)
  UVar = verifier.AppendElement("U", presentation.U)
  _ = verifier.AppendElement("UPrimeCommit", presentation.UPrimeCommit)
  m1CommitVar = verifier.AppendElement("m1Commit", presentation.m1Commit)
  VVar = verifier.AppendElement("V", presentation.V)
  X1Var = verifier.AppendElement("X1", serverPublicKey.X1)
  tagVar = prover.AppendElement("tag", presentation.tag)
  genTVar = verifier.AppendElement("genT", generatorT)
  m1TagVar = prover.AppendElement("m1Tag", m1Tag)

  # 1. m1Commit = m1 * U + z * generatorH
  verifier.Constrain(m1CommitVar, [(m1Var, UVar), (zVar, genHVar)])
  # 2. V = z * X1 - r * generatorG
  verifier.Constrain(VVar, [(zVar, X1Var), (rNegVar, genGVar)])
  # 3. G.HashToGroup(presentationContext, "Tag") = m1 * tag + nonceVar * tag
  verifier.Constrain(genTVar, [(m1Var, tagVar), (nonceVar, tagVar)])
  # 4. m1Tag = m1 * tag
  prover.Constrain(m1TagVar, [(m1Var, tagVar)])

  return verifier.Verify(presentation.proof)
</pre><a href="#section-5.4.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="ciphersuites">
<section id="section-6">
      <h2 id="name-ciphersuites">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-ciphersuites" class="section-name selfRef">Ciphersuites</a>
      </h2>
<p id="section-6-1">A ciphersuite (also referred to as 'suite' in this document) for the protocol
wraps the functionality required for the protocol to take place. The
ciphersuite should be available to both the client and server, and agreement
on the specific instantiation is assumed throughout.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">A ciphersuite contains instantiations of the following functionalities:<a href="#section-6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-3.1">
          <p id="section-6-3.1.1"><code>Group</code>: A prime-order Group exposing the API detailed in <a href="#pog" class="auto internal xref">Section 3.1</a>, with the
generator element defined in the corresponding reference for each group. Each
group also specifies HashToGroup, HashToScalar, and serialization
functionalities. For
HashToGroup, the domain separation tag (DST) is constructed in accordance
with the recommendations in <span>[<a href="#I-D.irtf-cfrg-hash-to-curve" class="cite xref">I-D.irtf-cfrg-hash-to-curve</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hash-to-curve-16#section-3.1" class="relref">Section 3.1</a></span>.
For HashToScalar, each group specifies an integer order that is used in
reducing integer values to a member of the corresponding scalar field.<a href="#section-6-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-3.2">
          <p id="section-6-3.2.1"><code>Hash</code>: A cryptographic hash function whose output length is Nh bytes long.<a href="#section-6-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-6-4">This section includes an initial set of ciphersuites with supported groups
and hash functions. It also includes implementation details for each ciphersuite,
focusing on input validation.<a href="#section-6-4" class="pilcrow">¶</a></p>
<div id="arcp-384-sha-384">
<section id="section-6.1">
        <h3 id="name-arcp-384-sha-384">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-arcp-384-sha-384" class="section-name selfRef">ARC(P-384, SHA-384)</a>
        </h3>
<p id="section-6.1-1">This ciphersuite uses P-384 <span>[<a href="#NISTCurves" class="cite xref">NISTCurves</a>]</span> for the Group and SHA-384 for the Hash
function. The value of the ciphersuite identifier is "P384-SHA384". The value of
contextString is "ARCV1-P384-SHA384".<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.1">
            <p id="section-6.1-2.1.1">Group: P-256 (secp256r1) <span>[<a href="#NISTCurves" class="cite xref">NISTCurves</a>]</span><a href="#section-6.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.1.2.1">
                <p id="section-6.1-2.1.2.1.1">Order(): Return 0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551.<a href="#section-6.1-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.2">
                <p id="section-6.1-2.1.2.2.1">Identity(): As defined in <span>[<a href="#NISTCurves" class="cite xref">NISTCurves</a>]</span>.<a href="#section-6.1-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.3">
                <p id="section-6.1-2.1.2.3.1">Generator(): As defined in <span>[<a href="#NISTCurves" class="cite xref">NISTCurves</a>]</span>.<a href="#section-6.1-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.4">
                <p id="section-6.1-2.1.2.4.1">RandomScalar(): Implemented by returning a uniformly random Scalar in the range
[0, <code>G.Order()</code> - 1]. Refer to <a href="#random-scalar" class="auto internal xref">Section 6.2</a> for implementation guidance.<a href="#section-6.1-2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.5">
                <p id="section-6.1-2.1.2.5.1">HashToGroup(x, info): Use hash_to_curve with suite P384_XMD:SHA-384_SSWU_RO_
<span>[<a href="#I-D.irtf-cfrg-hash-to-curve" class="cite xref">I-D.irtf-cfrg-hash-to-curve</a>]</span>, input <code>x</code>, and DST =
"HashToGroup-" || contextString || info.<a href="#section-6.1-2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.6">
                <p id="section-6.1-2.1.2.6.1">HashToScalar(x, info): Use hash_to_field from <span>[<a href="#I-D.irtf-cfrg-hash-to-curve" class="cite xref">I-D.irtf-cfrg-hash-to-curve</a>]</span>
using L = 72, <code>expand_message_xmd</code> with SHA-384, input <code>x</code> and
DST = "HashToScalar-" || contextString || info, and
prime modulus equal to <code>Group.Order()</code>.<a href="#section-6.1-2.1.2.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.7">
                <p id="section-6.1-2.1.2.7.1">ScalarInverse(s): Returns the multiplicative inverse of input Scalar <code>s</code> mod <code>Group.Order()</code>.<a href="#section-6.1-2.1.2.7.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.8">
                <p id="section-6.1-2.1.2.8.1">SerializeElement(A): Implemented using the compressed Elliptic-Curve-Point-to-Octet-String
method according to <span>[<a href="#SEC1" class="cite xref">SEC1</a>]</span>; Ne = 49.<a href="#section-6.1-2.1.2.8.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.9">
                <p id="section-6.1-2.1.2.9.1">DeserializeElement(buf): Implemented by attempting to deserialize a 49-byte array  to
a public key using the compressed Octet-String-to-Elliptic-Curve-Point method according to <span>[<a href="#SEC1" class="cite xref">SEC1</a>]</span>,
and then performs partial public-key validation as defined in section 5.6.2.3.4 of
<span>[<a href="#KEYAGREEMENT" class="cite xref">KEYAGREEMENT</a>]</span>. This includes checking that the
coordinates of the resulting point are in the correct range, that the point is on
the curve, and that the point is not the point at infinity. Additionally, this function
validates that the resulting element is not the group identity element.
If these checks fail, deserialization returns an InputValidationError error.<a href="#section-6.1-2.1.2.9.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.10">
                <p id="section-6.1-2.1.2.10.1">SerializeScalar(s): Implemented using the Field-Element-to-Octet-String conversion
according to <span>[<a href="#SEC1" class="cite xref">SEC1</a>]</span>; Ns = 48.<a href="#section-6.1-2.1.2.10.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.11">
                <p id="section-6.1-2.1.2.11.1">DeserializeScalar(buf): Implemented by attempting to deserialize a Scalar from a 48-byte
string using Octet-String-to-Field-Element from <span>[<a href="#SEC1" class="cite xref">SEC1</a>]</span>. This function can fail if the
input does not represent a Scalar in the range [0, <code>G.Order()</code> - 1].<a href="#section-6.1-2.1.2.11.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-6.1-2.2">
            <p id="section-6.1-2.2.1">Hash: SHA-256; Nh = 32.<a href="#section-6.1-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="random-scalar">
<section id="section-6.2">
        <h3 id="name-random-scalar-generation">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-random-scalar-generation" class="section-name selfRef">Random Scalar Generation</a>
        </h3>
<p id="section-6.2-1">Two popular algorithms for generating a random integer uniformly distributed in
the range [0, G.Order() -1] are as follows:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<div id="rejection-sampling">
<section id="section-6.2.1">
          <h4 id="name-rejection-sampling">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-rejection-sampling" class="section-name selfRef">Rejection Sampling</a>
          </h4>
<p id="section-6.2.1-1">Generate a random byte array with <code>Ns</code> bytes, and attempt to map to a Scalar
by calling <code>DeserializeScalar</code> in constant time. If it succeeds, return the
result. If it fails, try again with another random byte array, until the
procedure succeeds. Failure to implement <code>DeserializeScalar</code> in constant time
can leak information about the underlying corresponding Scalar.<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-2">As an optimization, if the group order is very close to a power of
2, it is acceptable to omit the rejection test completely.  In
particular, if the group order is p, and there is an integer b
such that |p - 2<sup>b</sup>| is less than 2<sup>(b/2)</sup>, then
<code>RandomScalar</code> can simply return a uniformly random integer of at
most b bits.<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="random-number-generation-using-extra-random-bits">
<section id="section-6.2.2">
          <h4 id="name-random-number-generation-us">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-random-number-generation-us" class="section-name selfRef">Random Number Generation Using Extra Random Bits</a>
          </h4>
<p id="section-6.2.2-1">Generate a random byte array with <code>L = ceil(((3 * ceil(log2(G.Order()))) / 2) / 8)</code>
bytes, and interpret it as an integer; reduce the integer modulo <code>G.Order()</code> and return the
result. See <span>[<a href="#I-D.irtf-cfrg-hash-to-curve" class="cite xref">I-D.irtf-cfrg-hash-to-curve</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hash-to-curve-16#section-5" class="relref">Section 5</a></span> for the underlying derivation of <code>L</code>.<a href="#section-6.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">For arguments about correctness, unforgeability, anonymity, and blind issuance of the ARC protocol, see the
"Formal Security Definitions for Keyed-Verification Anonymous Credentials" in <span>[<a href="#KVAC" class="cite xref">KVAC</a>]</span>.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">This section elaborates on unlinkability properties for ARC and other implementation details
necessary for these properties to hold.<a href="#section-7-2" class="pilcrow">¶</a></p>
<div id="credential-issuance-unlinkability">
<section id="section-7.1">
        <h3 id="name-credential-issuance-unlinka">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-credential-issuance-unlinka" class="section-name selfRef">Credential Issuance Unlinkability</a>
        </h3>
<p id="section-7.1-1">Client credential requests are constructed such that the server cannot distinguish between any two credential requests from the same client and two requests from different clients. We refer to this property as issuance unlinkability. This property is achieved by the way the credential requests are constructed. In particular, each credential request is computed using a freshly generated ElGamal encryption keypair and fresh blinding factors, which are used to encrypt a freshly generated client secret. The resulting request is therefore independent from other requests from the same client. More details about this unlinkability property can be found in <span>[<a href="#KVAC" class="cite xref">KVAC</a>]</span> and <span>[<a href="#REVISITING_KVAC" class="cite xref">REVISITING_KVAC</a>]</span>.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pres-unlinkability">
<section id="section-7.2">
        <h3 id="name-presentation-unlinkability">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-presentation-unlinkability" class="section-name selfRef">Presentation Unlinkability</a>
        </h3>
<p id="section-7.2-1">Client credential presentations are constructed so that all presentations are indistinguishable, even if coming from the same user. We refer to this property as presentation unlinkability. This property is achieved by the way the credential presentations are constructed. The presentation elements <code>[U, UPrimeCommit, m1Commit]</code> are indistinguishable from all other presentations made from credentials issued with the same server keys, as detailed in <span>[<a href="#KVAC" class="cite xref">KVAC</a>]</span>.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">The indistinguishability set for these presentation elements is <code>sum_{i=0}^c(p_i)</code>, where <code>c</code> is the number of credentials issued with the same server keys, and <code>p_i</code> is the number of presentations made for each of those credentials.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">The presentation elements <code>[tag, nonce, presentationContext, presentationProof]</code> are indistinguishable from all presentations made from credentials issued with the same server keys for that presentationContext, with the exception of presentations with the same nonce (since those presentations can be ascertained as being generated from different credentials, as long as the presentation tag is unique).<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2-4">The indistinguishability set for those presentation elements is <code>sum_{i=0}^c(p_i[presentationContext]) - k[presentationContext]</code>, where <code>c</code> is the number of credentials issued with the same server keys, <code>p_i[presentationContext]</code> is the number of presentations made for each of those credentials with the same presentationContext, and <code>k</code> is the number of presentations with the same nonce for that presentationContext. As long as the nonces are generated randomly from the range defined by the rate limit, <code>k[presentationContext]</code> should be roughly equal to <code>sum_{i=0}^c(p_i[presentationContext]) / n</code>, where <code>n</code> is the rate limit. Therefore, the indistinguishability set can be represented as <code>sum_{i=0}^c(p_i[presentationContext])(1 - 1/n)</code>, where a larger rate limit results in a larger indistinguishability set and therefore stronger unlinkability properties.<a href="#section-7.2-4" class="pilcrow">¶</a></p>
<p id="section-7.2-5">[[OPEN ISSUE: hide the nonce and replace the tag proof with a range proof built from something like Bulletproofs.]]<a href="#section-7.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="timing-leaks">
<section id="section-7.3">
        <h3 id="name-timing-leaks">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-timing-leaks" class="section-name selfRef">Timing Leaks</a>
        </h3>
<p id="section-7.3-1">To ensure no information is leaked during protocol execution, all operations that use secret data MUST run in constant time. This includes all prime-order group operations and proof-specific operations that operate on secret data, including proof generation and verification.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document has no IANA actions.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="test-vectors">
<section id="section-9">
      <h2 id="name-test-vectors">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
      </h2>
<p id="section-9-1">This section contains test vectors for the ARC ciphersuites specified in this document.<a href="#section-9-1" class="pilcrow">¶</a></p>
<div id="arcv1-p384-sha384">
<section id="section-9.1">
        <h3 id="name-arcv1-p384-sha384">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-arcv1-p384-sha384" class="section-name selfRef">ARCV1-P384-SHA384</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-9.1-1">
<pre>
// ServerKey
x0 = 504650f53df8f16f6861633388936ea23338fa65ec36e0290022b48eb562889
d89dbfa691d1cde91517fa222ed7ad364
x1 = 803d955f0e073a04aa5d92b3fb739f56f9db001266677f62c095021db018cd8
cbb55941d4073698ce45c405d1348b7b1
xb = 3a349db178a923aa7dff7d2d15d89756fd293126bb49a6d793cd77d7db960f5
692fec3b7ec07602c60cd32aee595dffd
X0 = 02a381dc21541b25ea6bc051a8233370995bc0b8527df7a4c11228bc2014e00
fe7ad53b56d9fa86d6cf599d79e993813b6
X1 = 02ca284486d14a67194c9dca7e2aae2e14f46c4ea56b70bf3ae1e2fff852e87
bf5e1b6471295029d98359fab2fa79c23d9
X2 = 0346c3a46971f0f454789d7d4c49b1b87136b25b89f34586bb67dce606878ae
da53a5b3d502ae21afded4e2303bb651ff0

// CredentialRequest
m1 = 5a32aaf031be0555089356d299ce24b0eedfe7939e2382934ab5b0f76aae441
24955d2c5ebf9b41d88786259c34692d2
m2 = c4e4669a8ad5403ec0b193d031aa155037384d6d77580358b3e1b87a86196c0
d907834c431b67a100575d988931b9dca
r1 = df2c61be3c0b37bc73dc89fc386c96b3008035081690bfde3b1e68b91443c22
cc791d244340fe957d5aa44d7313740df
r2 = 10fcb00134739cc403f27a79588ca05ad59c5e6ff560cc597c2b8ca25256c72
0bceca2ab03921492c5e9e4ad3b558002
m1_enc = 033d0be80843b4adc964b9a0161affb920845088557e2a25fce17cdfe96
41f35610395ae58a8865faee4b28efd512f655f
m2_enc = 038d9ece4fb250976e73b4c5c98e24d0a5e1fa261334741bece7422da95
1d7f315eb45bbdfb71c724fc9d269824ff70461
proof = bcea60d0db4935e6c456eeaa0129252a32e37550148bb21b7f29174d5988
cc2b55efc53c25ffeface21cac82237be5514d7e9f7204ace14881647d918a5843ab
d24bf7d27c4fe7b539180c85d449a19a1aa89b5284a35ee12051079a34069aec9bab
1f61431c7bb217da8e0b36d066f786fc9ea0a6468186258056ab38f3f950a7d4c2b6
6897e091684f7679a32dbdc659cc008254aeddd83a013471584ae18fe167dd82685b
0f58e77a968c29879af861cc5fc9f0ba1d90ea9830dcd2b2fdcda69580099246b283
88ede3498cd76792f71208998f5f53d2a78e07655936224739fbfa336e81551a256c
0a573c198b58

// CredentialResponse
b = b8b2e8c2103ad6f1970e873420d82a21e699140babbe599f7dd8f6e3e8f615e5
f201d1c2b0bc2f821f19e80a0a0e1e7b
U = 02be890d43908e52ed43ae7bc7098f3a7694617fe44a88c33c6fa4eb9e942c0b
2bb9d2fd56a44e1d6094fc7b9e8b949055
enc_U_prime = 0300ced2e8066878382787daf42ac9b7d4609c877e694d1d210a00
e3e3cbab068309b94355e542328b515f7d7bfaa11b64
X0_aux = 022bfd40d7aa7081d1d1a08066ae00b9def9182060ad98cd670cfee34ec
209cf2e73dc62eadbdb1dc063c16a1977015062
X1_aux = 02c785566d08135a6b3d68211998df139ccde12491dbad26c1b09d8de67
d2e72426fb2b852ba2dd97dbfa6804c1403ba2c
X2_aux = 032655de6f69e2213f18f3cf9923084d977204ad3949054fa99d4b334be
a17400681ca030ea0ba0971d1a318ef783e69f0
H_aux = 02f2d4d117f75eca253dd9e6e3c8385192c939e48de8da4073db58e1b856
96b7c410790f4033a063b95efdb478d2908e23
proof = 8193c6571bfb57e8b31a36b1f31b543c9d7c87211059832353c9519755b7
64c09a0096d7cc9c5ff6a414968e36c05aeb634c2f8bd920bbfae01d82bf67b28ba0
0b955be1d8fbec0b28fe764526d4ddad27175d73ad523a77812f6cc1217215a65b5d
b6d721a9b09e90c590ee6c7e112e4e6e7d990afb5328a9b1159695c7f51f33fa0be2
bb2593444a82f5f8f77b6d62181c26729bae07cdf7aba9bb0a3d19f291450ddf7849
21caf37355fb63991a05ffb43653688e09fea86b601f91c106ba8679e8168115750b
db90127670b19f80671ec8ac83bee1e1d6e5db3141c0f110ce313e41878a068e7c4b
a28b841270898cc13e70edf17bb8dbfe1626db5f9a1654c6e931b03a5f4fc6bbf791
08bcebb12b5c00ac5e49e01b9e36777455df3c1117e39e4e51f4812ed5f9c1eca1ae
5323974a15b9e8300265c5a966554a20a2319fc64af3b9290516b5bb2d5ff258b672
d68fd20d17606c43b1c930f5eec236282507b611ad58187a099dab3a7143b2825de7
745cb39ebc204f9d87c7314119d7

// Credential
m1 = 5a32aaf031be0555089356d299ce24b0eedfe7939e2382934ab5b0f76aae441
24955d2c5ebf9b41d88786259c34692d2
U = 02be890d43908e52ed43ae7bc7098f3a7694617fe44a88c33c6fa4eb9e942c0b
2bb9d2fd56a44e1d6094fc7b9e8b949055
U_prime = 02236d608191326f7432ace3188f27b506dc69107ba4feb822bf06f8e2
3cb123610188db6f5ccbddc809e0dbe5be7816bf
X1 = 02ca284486d14a67194c9dca7e2aae2e14f46c4ea56b70bf3ae1e2fff852e87
bf5e1b6471295029d98359fab2fa79c23d9

// Presentation
a = ad00ec0f71b7a8fb7c0aef35c7243e17b78e57df8f0a95d102ff12bbb97e15ed
35c23e54f9b4483d30b76772ee60d886
r = e5cab8c896187b61abe017e57022528742252210dd60ddbbf1a57e3b144e26dd
693b7644a9626a8c36896ede53d12930
z = f61f4c924d3ef04b31e9196935ff27c5f5a4bbcf14e55e357df9f5ccb5ded37b
2b14bc2e1a68e31f86416f0606ee75d1
generator_T = 021a48e8c63f53a8a5e3323c782e5ab5b4c0b8fceaadd5b353acc4
3cac3b6ab83ae1972ddb75c68ec7deeeecf6ca671c16
U = 03383b2ad2831739bc86c0c98119f256e54c9d89a762a9fc91b3904eb3aee726
0350a19085ea093a8059369219f03da2c3
U_prime = 0381f6c09fd14e99f3a7130ae96b06b0add749e0c8f192aa3d25431359
bd6053519113f2a067ce43e5daf339439e2ee893
U_prime_commit = 0207a1370952135acc63b6770642b2ad37fbaf68c43facb51ef
ca4adf4d5bd3dfb1b25f59975ebc49104e13c9bcb6f6686
m1_commit = 02a592d70b2bffd2a0d904395bc55c93ce5dff83d660d780abb32bae
51e0481275e6b615ec7e18f0f7371f1fd8a6b61a00
nonce = 0x1
tag = 0290f2f74fee40bf5cf3456326a4ee3d654c0c7519787e76843febedd08cb0
6b33d9acc5ce8584d12a121cd7f92384289c
proof = 02efe2b6c01536a2e03fd9cc3f33e0b1cb75954b3db0820fe4080afbd0ea
48d734a1e10edb318ae450d801a289da9c17853f7d49dcbf04f29a9b304da563f139
e6fc746d75cc0a09814f70c2d67e70956fe5275f2d5188cf4b49d608274566391975
4e162e29b0a412fe047b21cc342cdedc7bdb3318e195caee4569b454d45d554ef0b4
86c6c6da4ef082a263c796c4dc737fd3f71048a881a49c791b8b556fac7d99d4da35
6cb58c1107dd195658263a56de5971ce74be11cb7ac0ba8c8030fd101d493feac95d
1fc02633c0cc1f4e348a6ab4c24f7defe35b4286234ce50823782ca36d7f1c969c14
17c842ea8d60

</pre><a href="#section-9.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="section-10">
      <h2 id="name-acknowledgments">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-10-1">The authors would like to acknowledge helpful conversations with Tommy Pauly about rate limiting and Privacy Pass integration.<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-combined-references">
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.irtf-cfrg-hash-to-curve">[I-D.irtf-cfrg-hash-to-curve]</dt>
        <dd>
<span class="refAuthor">Faz-Hernandez, A.</span>, <span class="refAuthor">Scott, S.</span>, <span class="refAuthor">Sullivan, N.</span>, <span class="refAuthor">Wahby, R. S.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Hashing to Elliptic Curves"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-hash-to-curve-16</span>, <time datetime="2022-06-15" class="refDate">15 June 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hash-to-curve-16">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hash-to-curve-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="KEYAGREEMENT">[KEYAGREEMENT]</dt>
        <dd>
<span class="refAuthor">Barker, E.</span>, <span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Roginsky, A.</span>, <span class="refAuthor">Vassilev, A.</span>, and <span class="refAuthor">R. Davis</span>, <span class="refTitle">"Recommendation for pair-wise key-establishment schemes using discrete logarithm cryptography"</span>, <span class="refContent">National Institute of Standards and Technology</span>, <span class="seriesInfo">DOI 10.6028/nist.sp.800-56ar3</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.sp.800-56ar3">https://doi.org/10.6028/nist.sp.800-56ar3</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8017">[RFC8017]</dt>
      <dd>
<span class="refAuthor">Moriarty, K., Ed.</span>, <span class="refAuthor">Kaliski, B.</span>, <span class="refAuthor">Jonsson, J.</span>, and <span class="refAuthor">A. Rusch</span>, <span class="refTitle">"PKCS #1: RSA Cryptography Specifications Version 2.2"</span>, <span class="seriesInfo">RFC 8017</span>, <span class="seriesInfo">DOI 10.17487/RFC8017</span>, <time datetime="2016-11" class="refDate">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8017">https://www.rfc-editor.org/rfc/rfc8017</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BLIND-RSA">[BLIND-RSA]</dt>
        <dd>
<span class="refAuthor">Denis, F.</span>, <span class="refAuthor">Jacobs, F.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"RSA Blind Signatures"</span>, <span class="seriesInfo">RFC 9474</span>, <span class="seriesInfo">DOI 10.17487/RFC9474</span>, <time datetime="2023-10" class="refDate">October 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9474">https://www.rfc-editor.org/rfc/rfc9474</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="KVAC">[KVAC]</dt>
        <dd>
<span class="refTitle">"Keyed-Verification Anonymous Credentials from Algebraic MACs"</span>, <span>n.d.</span>, <span>&lt;<a href="https://eprint.iacr.org/2013/516">https://eprint.iacr.org/2013/516</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NISTCurves">[NISTCurves]</dt>
        <dd>
<span class="refTitle">"Digital signature standard (DSS)"</span>, <span class="refContent">National Institute of Standards and Technology (U.S.)</span>, <span class="seriesInfo">DOI 10.6028/nist.fips.186-4</span>, <time datetime="2013" class="refDate">2013</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.fips.186-4">https://doi.org/10.6028/nist.fips.186-4</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OPRFS">[OPRFS]</dt>
        <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Faz-Hernandez, A.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious Pseudorandom Functions (OPRFs) Using Prime-Order Groups"</span>, <span class="seriesInfo">RFC 9497</span>, <span class="seriesInfo">DOI 10.17487/RFC9497</span>, <time datetime="2023-12" class="refDate">December 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9497">https://www.rfc-editor.org/rfc/rfc9497</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="REVISITING_KVAC">[REVISITING_KVAC]</dt>
        <dd>
<span class="refTitle">"Revisiting Keyed-Verification Anonymous Credentials"</span>, <span>n.d.</span>, <span>&lt;<a href="https://eprint.iacr.org/2024/1552">https://eprint.iacr.org/2024/1552</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SEC1">[SEC1]</dt>
      <dd>
<span class="refAuthor">Standards for Efficient Cryptography Group (SECG)</span>, <span class="refTitle">"SEC 1: Elliptic Curve Cryptography"</span>, <span>&lt;<a href="https://www.secg.org/sec1-v2.pdf">https://www.secg.org/sec1-v2.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Cathie Yun</span></div>
<div dir="auto" class="left"><span class="org">Apple, Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:cathie@apple.com" class="email">cathie@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Apple, Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
